---
title: 计算机体系
published: 2025-12-09
tags:
  - 学习笔记
  - 计算机体系结构
category: 课程
draft: true
---
## 第四章向量处理机
向量:是一组有序的，具有相同类型和位数的元素组成
向量的优点：适合大量，重复，没有相互关联的（流水线处理）
向量流水处理机：设置向量数据表示和相应的向量指令
标量流水处理机：不具备向量数据表示和相应的向量指令
典型的向量处理机：Cray-1，每秒1亿次
向量处理机的应用领域：科学运算
### 向量的处理方式
#### 横向处理方式
按行的方式计算
特点：只适合一般处理机
数据相关和功能切换：n  n
#### 纵向处理方式
按照列的方式计算
特点：适用于向量处理的并行处理
数据相关和功能切换:1 1 
#### 纵横处理方式
把计算机分成多组，组内按照纵向方式，组间按照横向方式处理
特点：对长度N的大小不限制，但是要n个元素为一组进行处理；n的值是固定的
数据相关和功能切换:1 1
### 向量处理机的结构
结构：存储器-存储器型结构；寄存器-寄存器型结构
#### 存储器-存储器结构
适用范围：纵向处理方式的向量处理机
结构特点：
1、向量指令的源向量和目的向量都存放在存储器中，运算的中间结果需要送回到存储器中
2、运算部件的输入和输出都直接与存储器相连
运行条件：每拍从存储器中读取两个数据，并且向存储器写回一个结果
问题：对存储器的带宽和存储器与处理部件之间的通行带宽有很高的要求
解决方案：采用多体交叉并行存储器和缓冲器技术
#### 寄存器-寄存器型结构
适用范围：分组处理的向量处理机
结构特点：
1.能设置快速访问的向量寄存器，存放源向量和目标向量和中间结果
2.运算部件的输入和输出都直接与寄存器相连
#### CRAY-1向量处理机
基本结构：
1）功能部件
12条单功能流水线
进行向量运算的单功能流水部件：整数加，逻辑运算，移位，浮点加，浮点乘，浮点迭代求倒数

| 单功能流水部件 | 流水线通过时间（一拍12.5ns） |
| ------- | ----------------- |
| 整数加     | 3拍                |
| 逻辑运算    | 2                 |
| 移位      | 4                 |
| 浮点加     | 6                 |
| 浮点乘     | 7                 |
| 浮点迭加求倒数 | 14                |

2）向量寄存组V
512 64 8
由512个寄存器组成的64位的寄存器组
分成8小组（每组64个寄存器）
每个小组可存放一个元素个数不超过64个的向量，每个元素的大小不超过64位
每个寄存器每拍可以从功能部件中提取一个数据元素或者返回一个结果元素
3)标量寄存器S和快速暂存器T
标量寄存器有8个，快速暂存器为标量寄存器和存储器之间提供缓冲
4)向量屏蔽器VM
用于对向量的归并，压缩，还原，测试或者单独运算
#### CRAY-1的显著特点
1、每个向量寄存器都有一条连接到六个流水线单功能部件的单独总线
2、每个向量功能部件都有把运算结果返回到向量寄存器的总线
3、只要不发生vi冲突和功能部件冲突，各个功能部件能够并行处理，提高了效率
#### Vi冲突和功能冲突
并行工作的各个向量指令使用了相同vi的源向量或者结果向量
功能部件冲突：并行工作的向量指令使用了相同的功能部件
#### CRAY-1的四种向量指令
1.两个操作数都来自向量寄存器
2.一个数据来自向量寄存器一个来自标量寄存器
3.从主存中国向向量寄存器成组地传送数据
4.从向量寄存器中向主存成组地传送数据
提高向量处理机性能的方法
采用多个功能部件，循环开采技术，==链接技术和多处理机技术

设置多个功能部件：这些功能部件能够按照各自的流水线工作的，形成并行的流水线，互不干扰
链接技术：4种情况：指令不相关，功能部件冲突，源寄存器冲突，结果寄存器冲突
适合上一步的结果寄存器是下一步的源寄存器并且没有任何其他冲突的情况

第五章
指令级并行：指令具有并行性 ，在没有结构冲突和数据冲突的情况下，指令可以并行，指令级并行是指两条或者两条以上的执行同时执行
开发ILP的方法：基于软件的动态开发方法，基于硬件的动态开发方法
增加指令并行性的方法：循环级并行，在循环的不同迭代中存在并行性，因为循环的每一次都是不同的，所以可以并行，这是最简单的 并行性的体现；采用向量指令和向量数据表示
相关的三种类型：数据相关，名相关，控制相关
流水线冲突的几种类型：结构冲突，数据冲突，控制冲突
相关的作用：相关是指指令之间的相互依赖关系，是程序的一种属性，相关造成的冲突和以及该冲突造成的停顿，属于流水线的属性
从两个方面解决相关的问题：
一个是保持相关，通过调度来减小相关产生的影响，一个是消除相关，通过寄存器换名
程序顺序：程序顺序，是指完全串行，就是前一条指令执行完之后，后一条指令才能执行
程序的正确性：包括数据流和异常行为，数据流是指数据值从产生者指令到消费者指令的实际流动，异常行为如果无法消除的话，不能绕过，只能让它保持
静态调度：
 定义：静态调度是指通过编译器对代码进行静态调度，来减少相关和冲突
 特点：是在编译器进行的，不是在代码执行过程中对代码进行调度和优化
 方法：把指令拉开距离来减少可能产生的停顿，比如定向，延迟槽，停顿等

动态调度：
 定义：在程序的执行过程中，通过专门的硬件对代码进行调度和优化，减少数据相关可能产生的停顿
 优点：可以解决一些在编译器中来源不明的指令，这条流水线的动态调度可以被其他流水线上执行
 缺点：硬件的复杂性明显提高
 方法：通过硬件对指令执行顺序进行调度
动态调度的基本思想：
 最大局限性：指令按序流出，按序执行
 冲突的检测：检测结构冲突和数据冲突，当既没有结构冲突也没有数据冲突的时候，可以指令流出
 问题的解决：检测结构冲突，等待数据冲突解决。当没有结构冲突的时候，指令就可以执行，当操作数就绪，这个指令就可以立即执行
乱序执行：
　流出：当检测到没有结构冲突的时候，指令就可以流出
　读操作数：等待数据冲突结束，就可以读操作数
　可能会发生读后写冲突和写后读冲突：
　　
乱序完成：指令的完成顺序和执行的完成顺序不一样
动态调度的流水线：
　优点：可以多条指令处于执行过程中
　要求：多个功能部件或者功能部件流水化，或者二者兼有
　典型的动态调度算法：记分牌算法，tomasulo算法
记分牌动态调度算法：
　基本思想：有一个专门的硬件叫做积分牌，通过记分牌来记录指令的执行和流出。记分牌中维护着三张表，指令状态表，寄存器状态表，执行状态表和数据相关关系
　目标：在没有结构冲突的情况下，尽可能早地执行没有数据冲突的指令，每一个时钟周期执行一个指令
　前提条件：具有多个功能部件
记分牌算法的基本工作原理：
　采用了记分牌的ＭＩＰＳ处理器的基本结构
　　部件：2个乘法器，1个加法器，1个除法部件，1个整数部件
　　要求：
　　　１每个指令的执行都要经过记分牌
　　　２记分牌控制每个指令的执行和流出
　　　３指令流出时，记分牌记录相关的信息，并且决定该条指令什么时候可以读操作数和执行
　指令执行过程：
　　流出：当流出指令所需要的功能部件空闲，并且指令涉及到的目标寄存器和正在执行的指令的目标寄存器不同，记分牌向功能部件流出该指令，并且修改内部表的状态。解决了写后写和结构冲突
　　读操作数：当检测到操作数可用是，通知功能部件把操作数同寄存器中取出来并且开始执行，解决了写后读冲突，但可能导致乱序执行
　　执行：取到操作数就开始执行，执行产生结果之后，就通知记分牌他已经完成了
　　写结果：当记分牌知道指令已经执行完成之后，就检测是否存在写后读冲突，如果存在就必须等到写后读冲突消失，才能把结果写到目的寄存器中，如果不存在写后读冲突，就直接把结果写到寄存器中
　记分牌中记录的信息由三部分组成：
　　指令状态表：记录正在执行的指令进行到哪一步了
　　功能部件状态表：记录功能部件的状态
　　结果寄存器状态表：指出哪个功能部件将把结果写入到该寄存器
Tomasulo算法：
 核心思想：记录和检测指令相关，一旦操作数就绪就立即执行，把发生读后写冲突的可能性降到最低，通过寄存器换名来解决WAR,WAW冲突
 基于Tomasulo算法的MIPSc处理器执行分析
  保留站：保留已经流入，并且等待到本功能部件执行的指令
  公共数据总线：所有功能部件的计算结果都流入懂啊CDB中
  load缓冲器和store缓冲器：当作保留站看带，存放计算有效地址的分量，记录正在进行的load和stroe访存，保存已经完成的结果
  浮点寄存器：FP
  指令队列：先进先出
  运算部件：
在tomasulo算法中，寄存器换名的实现：
实例说明tumasulo算法的基本思想：
tomasulo算法中指令执行的一般步骤：
 1：流出
 2：执行
 3：写结果
保留站点字段：
 Busy:本保留站忙
 Op：对源操作数进行操作
 Vj,Vk:源操作数的值
 Qj,Qk:将产生操作数的保留站号
 A:开始时存放立即数字段，地址计算后存放有效地址
寄存器状态表：
tomasulo算法的两个主要优点：
冲突逻辑的检测是分布的
消除了WAR和WAW冲突

